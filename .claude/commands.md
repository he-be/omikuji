# Custom Commands for Claude Code

## Core Workflow Commands

### /check-ci

GitHub Actions の CI を確認し、失敗時は自動修正します。

以下の STEP に従ってください：

1. `gh` コマンドを利用して現在のブランチに紐づいている PR の CI を確認します。
2. コマンドが実行中の場合には `sleep 60` で 1 分間待機してください。
3. CI が成功している場合には特にやることがありません。
4. CI が失敗している場合は失敗した内容を確認します。
5. ローカル環境で失敗原因を再現し、ソースコードの問題を特定します。
6. 修正をプランし、更新後 Push します。

### /sync-main

Issue 対応間に実行するコマンドです。作業ブランチをマージ後、main ブランチに戻って最新状態に更新します。

以下のステップに従ってください：

1. `git status` を実行し更新漏れがないことを確認します。
2. `git switch main` を実行し main ブランチに移動します。
3. `git pull` を実行し main ブランチを更新します。
4. 更新内容や現状を簡単に報告します。

### /deploy-test

デプロイメントをテストします。

以下のステップに従ってください：

1. 現在のブランチとコミット状況を確認
2. ビルドプロセスをローカルで実行
3. テストスイートを実行してカバレッジを確認
4. main ブランチにプッシュしてデプロイをトリガー
5. CI/CD パイプラインの実行を監視
6. デプロイ完了後、実際のエンドポイントをテスト

## Project Setup Commands

### /setup-fullstack

フルスタック TypeScript プロジェクトを個人開発最適化設定でセットアップします。

以下を含む完全なプロジェクトを作成してください：

1. **基本設定**:
   - TypeScript strict mode + 最新設定
   - Vitest テストフレームワーク（カバレッジ 80%+ 設定）
   - ESLint + Prettier 統合

2. **CI/CD パイプライン**:
   - GitHub Actions self-hosted runner 対応
   - 段階的品質チェック（lint → typecheck → test → coverage）
   - Cloudflare Workers 自動デプロイ

3. **開発効率化**:
   - Claude.md 配置（個人開発ルール込み）
   - .claude/ フォルダ（カスタムコマンド）
   - package.json スクリプト最適化

4. **プロジェクト構造**:
   ```
   src/
   ├── index.ts          # Express版（開発用）
   ├── worker.ts         # Cloudflare Workers版（本番用）
   └── __tests__/        # テストファイル
   ```

### /setup-cloudflare

既存プロジェクトに Cloudflare Workers デプロイを追加します。

以下を実行してください：

1. Wrangler CLI インストールと設定
2. Workers 対応版コード作成（Web標準API）
3. wrangler.toml 設定ファイル作成
4. GitHub Actions デプロイステージ追加
5. 環境変数とシークレット設定ガイド表示
6. デプロイテスト実行

## /add-feature [feature-name]

新機能を実装します。テスト駆動開発に従い、以下を実行してください：

1. 機能要件を確認し、実装計画を立案
2. 必要な依存関係をインストール
3. テストファイルを先に作成
4. 実装コードを作成
5. カバレッジ 80% 以上を確保
6. コミットして PR 作成

## /fix-coverage

テストカバレッジを改善します。

1. 現在のカバレッジレポートを確認
2. 未カバーのコード部分を特定
3. 不足しているテストケースを追加
4. エッジケースとエラーケースを含める
5. 80% 以上のカバレッジを達成

## /optimize-ci

CI/CD パイプラインを最適化します。

1. 現在の CI 実行時間を測定
2. ボトルネックを特定
3. キャッシュ設定の改善
4. 並列実行の最適化
5. 不要なステップの削除
6. パフォーマンス改善の実装

## /create-docs

プロジェクトドキュメントを作成・更新します。

1. README.md の更新
2. API ドキュメントの生成
3. 開発者ガイドの作成
4. デプロイメント手順の記載
5. トラブルシューティングガイドの追加

## /security-audit

セキュリティ監査を実行します。

1. `npm audit` の実行
2. 脆弱性の確認と修正
3. 依存関係の更新
4. セキュリティベストプラクティスの適用
5. CI にセキュリティチェックを追加

## /deploy-prep

デプロイメント準備を行います。

1. 本番環境向けビルドの検証
2. 環境変数の確認
3. データベースマイグレーションの準備
4. ヘルスチェックエンドポイントの確認
5. ロールバック手順の準備